<!DOCTYPE html>
<html>
<head>
	<title>Batmanreturns</title>
	<%= stylesheet_link_tag 'screen.css', :media => 'screen, projection' %>
	<%= stylesheet_link_tag 'print.css', :media => 'print' %>
	<!--[if lt IE 8]><%= stylesheet_link_tag 'ie.css', :media => 'screen, projection' %><![endif]-->
	<%= javascript_include_tag :defaults %>、
	<%= csrf_meta_tag %>
</head>
<div id="header">
	<div id="headerContent">
		<h1 id="name"><a href="/">iFixit</a></h1>
		<ul id="headerIcons">
			<li id="headerRepair">
				<a href="/Guide">Repair</a>
			</li>
			<li id="headerAnswers" class="active">
				<a href="/Answers/">Answers</a>
			</li>
			<li id="headerContribute">
				<a href="/Contribute">Contribute</a>
			</li>
			<li id="headerParts">
				<a href="/Parts-Store">Parts &amp; Tools</a>
			</li>
		</ul>
	</div>
</div>
<body class="bp two-col">
    <!--登 陆 以 后 执 行-->
	<% if current_user %>
	    <ul id="notifications">
	    <% puts current_user.username %>
	    <% current_user.notifications.find_all_by_read(false).each do |notification|%>
			<li class="notification">
	      		<%= new_notification(notification.sender_id, notification.sender_name, notification.description, notification.subject_id, notification.subject_content) %>
			</li>
	    <% end %>
	    </ul>
	


    <script>
    	var pusher = new Pusher('2f20b4687fdaada149b2');
    	var c = pusher.subscribe("presence-channel_<%= current_user.id %>");

    	c.bind('notification_created', function(notification) {
    		$('#notifications').append("<li class='notifications'><div class='strong'><p><a href='/users/" + notification.sender_id + "'>" + notification.sender_name + "</a>" + notification.description + "<a href='/questions/" + notification.subject_id + "'>" + notification.subject_content + "</a><a href='/questions/" + notification.subject_id + "'>" + notification.object_content + "</a></p></div></li>");
    	});

    </script>
    
    <% end %>
    
	<div id="container">
		<%= yield %>
	</div>
</body>
</html>
